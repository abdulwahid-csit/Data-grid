<div class="position-relative h-100">
  <div
    class="d-flex justify-content-between mb-3 align-items-center position-relative"
  >
    <div class="col-4 global-search">
      <span
        [inlineSVG]="'assets/icons/search.svg'"
        class="mx-2 position-absolute"
      ></span>
      <input
        class="form-control form-control-sm"
        placeholder="Search all columns"
        type="search"
      />
    </div>
    <div class="d-flex gap-2">
      <div
        class="cursor-pointer"
        (click)="showFilters = !showFilters"
        [class.active]="showFilters"
      >
        <span
          [inlineSVG]="'assets/icons/filter-2.svg'"
          class="top-icon me-2"
        ></span>
      </div>
      <div
        class="cursor-pointer"
        (click)="toggleActions('advance-filter')"
        [class.active]="activeTopButton === 'advance-filter'"
      >
        <span
          [inlineSVG]="'assets/icons/zoom-charge.svg'"
          class="top-icon me-2"
        ></span>
      </div>
      <div
        class="cursor-pointer"
        (click)="toggleActions('setting')"
        [class.active]="
          activeTopButton === 'setting' ||
          activeTopButton === 'table-layout' ||
          activeTopButton === 'table-presets' ||
          activeTopButton === 'show-hide-columns'
        "
      >
        <span
          [inlineSVG]="'assets/icons/settings-2.svg'"
          class="top-icon me-2"
        ></span>

        <div
          *ngIf="activeTopButton === 'setting'"
          class="actions-dropdown mt-1 actions-dropdown-setting"
        >
          <div class="dropdown-menu show shadow custom-menu">
            <!-- Table Layout -->
            <a
              class="dropdown-item d-flex justify-content-between align-items-center"
              (click)="$event.stopPropagation(); toggleActions('table-layout')"
            >
              <span
                ><span
                  [inlineSVG]="'assets/icons/table-2.svg'"
                  class="me-2"
                ></span>
                Table Layout</span
              >
              <i class="bi bi-chevron-right"></i>
            </a>
            <!-- Table Presets -->
            <a
              (click)="$event.stopPropagation(); toggleActions('table-presets')"
              class="dropdown-item d-flex justify-content-between align-items-center"
            >
              <span
                ><span
                  [inlineSVG]="'assets/icons/list-details.svg'"
                  class="me-2"
                ></span>
                Table Presets</span
              >
              <i class="bi bi-chevron-right"></i>
            </a>

            <!-- Columns -->
            <a
              *ngIf="!showSideMenu"
              (click)="
                $event.stopPropagation(); toggleActions('show-hide-columns')
              "
              class="dropdown-item d-flex justify-content-between align-items-center"
            >
              <span
                ><span [inlineSVG]="'assets/icons/eye.svg'" class="me-2"></span>
                Columns</span
              >
              <span class="text-muted">{{ columnsCount }}</span>
            </a>

            <div class="dropdown-divider"></div>

            <!-- Filter -->
            <a class="dropdown-item">
              <span
                [inlineSVG]="'assets/icons/filter-2.svg'"
                class="me-2"
              ></span>
              Filter
            </a>

            <!-- Download -->
            <a class="dropdown-item">
              <span
                [inlineSVG]="'assets/icons/download.svg'"
                class="me-2"
              ></span>
              Download as CSV
            </a>
          </div>
        </div>

        <!-- Table Layout -->

        <ng-container *ngIf="activeTopButton === 'table-layout'">
          <div
            *ngTemplateOutlet="tableLayout"
            class="actions-dropdown mt-1"
          ></div>
        </ng-container>

        <!-- Table Presets -->
        <ng-container *ngIf="activeTopButton === 'table-presets'">
          <div
            *ngTemplateOutlet="tablePreset"
            class="actions-dropdown mt-1"
          ></div>
        </ng-container>

        <!-- Table Presets -->
        <ng-container *ngIf="activeTopButton === 'show-hide-columns'">
          <div
            *ngTemplateOutlet="showHideColumns"
            class="actions-dropdown mt-1"
          ></div>
        </ng-container>
      </div>
      <div>
        <!-- Example single danger button -->

        <button
          type="button"
          class="btn btn-primary btn-sm d-flex gap-2 action-button"
          (click)="toggleActions('actions')"
        >
          Action
          <span [inlineSVG]="'assets/icons/Vector.svg'" class=""></span>
        </button>

        <!-- Dropdown overlay -->
        <div
          *ngIf="activeTopButton === 'actions'"
          class="actions-dropdown mt-1"
        >
          <div class="dropdown-menu show">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <a class="dropdown-item" href="#">Something else here</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Separated link</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    *ngIf="showFilters"
    class="top-filter-row border-top py-2 d-flex gap-2"
    [style.height.px]="topFilterRowHeight"
  >
    <div *ngFor="let col of activeFilteredColumns" class="filter-tags">
      <div
        (click)="
          isActiveFilterOpen = true;
          activeTopButton = 'filter-columns';
          openFilter(col)
        "
        class="d-flex justify-content-center align-items-center text-muted add-filter-button active-filters"
        style="white-space: nowrap"
        [class.active]="
          col.field == selectedColumnForFilter.field &&
          isActiveFilterOpen &&
          activeTopButton == 'filter-columns'
        "
      >
        <span class="header-tag mt-0"
          ><span
            *ngIf="col?.pinned"
            [inlineSVG]="'assets/icons/pin.svg'"
            class="me-2"
          ></span
          >{{ col.header }}</span
        >
      </div>
      <ng-container
        *ngIf="
          activeTopButton === 'filter-columns' &&
          col.field == selectedColumnForFilter.field &&
          isActiveFilterOpen
        "
      >
        <div
          *ngTemplateOutlet="filterColumns; context: { column: col }"
          class="actions-dropdown mt-1"
        ></div>
      </ng-container>
    </div>

    <div>
      <div
        (click)="toggleActions('filter-columns'); isActiveFilterOpen = false"
        class="d-flex justify-content-center align-items-center text-muted add-filter-button"
        style="width: 70px"
      >
        <span [inlineSVG]="'assets/icons/plus.svg'" class="me-2"></span>Filter
      </div>
      <ng-container
        *ngIf="activeTopButton === 'filter-columns' && !isActiveFilterOpen"
      >
        <div
          *ngTemplateOutlet="filterColumns"
          class="actions-dropdown mt-1"
        ></div>
      </ng-container>
    </div>
  </div>

  <div
    [style.height]="
      showFilters ? 'calc(100% - ' + topFilterRowHeight + 'px)' : '100%'
    "
    cdkDropListGroup
    class="data-grid-table-wrapper overflow-hidden"
    #dataGridContainer
    [style.fontFamily]="fontFaimly"
  >
    <div
      *ngIf="showRowsGrouping"
      [style.height.px]="headerRowHeight"
      [cdkDropListData]="columns"
      cdkDropList
      (cdkDropListEntered)="enterToTopRowGrouping($event)"
      (cdkDropListExited)="exitedFromTheTopRow($event)"
      (cdkDropListDropped)="onDropTopGroup($event)"
      [cdkDropListEnterPredicate]="canEnterToRowsGrouping"
      id="rows-grouping-top-container"
      class="border-bottom d-flex px-4 align-items-center"
    >
      <div class="d-flex gap-2 align-items-center">
        <i class="bi bi-justify"></i>
        <div *ngIf="!draggingInGroupArea && !groupedColumns?.length">
          Drag here to set row groups
        </div>
        <ng-container *ngFor="let child of groupedColumns; let i = index">
          <ng-container
            *ngTemplateOutlet="
              topGroupingRowPlaceholder;
              context: {
                $implicit: child,
                showChevron:
                  groupedColumns.length > 1 && i != groupedColumns.length - 1
              }
            "
          ></ng-container>
        </ng-container>
      </div>
    </div>
    <div
      class="d-flex overflow-hidden"
      [style.height]="
        'calc(100% - ' +
        (showRowsGrouping
          ? headerRowHeight + footerRowHeight
          : footerRowHeight) +
        'px)'
      "
    >
      <div
        class="h-100"
        [style.width]="
          !showSideMenu
            ? '100%'
            : sideMenuVisible
            ? 'calc(100% - 280px)'
            : 'calc(100% - 30px)'
        "
      >
        <div class="h-100 transition position-relative w-100">
          <!-- ##################################################################################################################################################################################### -->
          <!-- ##################################################################################################################################################################################### -->
          <!-- Data Grid Header starts here -->
          <!-- ##################################################################################################################################################################################### -->
          <!-- ##################################################################################################################################################################################### -->

          <div
            class="data-grid-header-wrapper w-100"
            [style.color]="headerTextColor"
            [style.fontSize.px]="headerTextFontsSize"
            [style.backgroundColor]="headerBackgroundColor"
            [class.border-bottom]="!hasAnyVisibleColumn"
            [style.height.px]="
              showColumnsGrouping && !hasAnyVisibleColumn && showFilterRow
                ? headerRowHeight * 3
                : (showColumnsGrouping || showFilterRow) && !hasAnyVisibleColumn
                ? headerRowHeight * 2
                : headerRowHeight
            "
          >
            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <!-- Data Grid Left Pinned Header starts here -->
            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <div class="data-grid-header left-pinned" #leftPinnedHeader>
              <div
                [style.backgroundColor]="checkboxesBackgroundColor"
                class="select-all-checkbox-cell border-bottom"
                [style.height.px]="
                  showColumnsGrouping && showFilterRow
                    ? headerRowHeight * 3
                    : showColumnsGrouping || showFilterRow
                    ? headerRowHeight * 2
                    : headerRowHeight
                "
              >
                <input
                  *ngIf="hasAnyVisibleColumn"
                  type="checkbox"
                  [checked]="isAllSelected(dataSet)"
                  (change)="toggleSelectAll(dataSet)"
                />
              </div>
              <div
                class="d-flex"
                cdkDropList
                id="left-pinned-header"
                cdkDropListOrientation="horizontal"
                [cdkDropListData]="leftPinnedColumns"
                (cdkDropListEntered)="onDropListEnter($event, 'left')"
                (cdkDropListSorted)="onSortGroup($event, 'left')"
                (cdkDropListDropped)="onDropGroup()"
                style="min-width: 0.2px"
                [style.background-color]="headerBackgroundColor"
              >
                <div
                  cdkDrag
                  [cdkDragData]="col"
                  *ngFor="let col of leftPinnedColumns; let i = index"
                >
                  <ng-container
                    *ngTemplateOutlet="
                      headerCell;
                      context: {
                        $implicit: col,
                        index: i,
                        section: 'leftPinnedColumns'
                      }
                    "
                  ></ng-container>
                  <ng-template cdkDragPreview
                    ><div class="p-2 border d-flex gap-2">
                      <div><i class="bi bi-arrows-move"></i></div>
                      <div>{{ col.header }}</div>
                    </div>
                  </ng-template>
                  <ng-template cdkDragPlaceholder>
                    <div *ngIf="!draggingInGroupArea">
                      <div
                        *ngTemplateOutlet="
                          headerCell;
                          context: {
                            $implicit: col,
                            index: i,
                            section: 'centerColumns'
                          }
                        "
                      ></div>
                    </div>
                    <div
                      *ngIf="draggingInGroupArea"
                      class="d-flex gap-2 ms-2"
                      style="opacity: 0.6"
                    >
                      <ng-container
                        *ngIf="col?.children?.length; else singleCol"
                      >
                        <ng-container
                          *ngFor="let child of col.children; let i = index"
                        >
                          <ng-container
                            *ngTemplateOutlet="
                              topGroupingRowPlaceholder;
                              context: {
                                $implicit: child,
                                showChevron:
                                  col.children.length > 1 &&
                                  i != col.children.length - 1
                              }
                            "
                          ></ng-container>
                        </ng-container>
                      </ng-container>

                      <ng-template #singleCol>
                        <ng-container
                          *ngTemplateOutlet="
                            topGroupingRowPlaceholder;
                            context: {
                              $implicit: col,
                              showChevron: col?.children?.length > 1
                            }
                          "
                        ></ng-container>
                      </ng-template>
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>

            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <!-- Data Grid Center Pinned Header starts here -->
            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <div
              class="data-grid-header center-scrollable"
              #centerPinnedHeader
              (scroll)="onCenterHeaderScroll($event)"
              id="center-pinned-header"
              cdkDropList
              cdkDropListConnectedTo="rows-grouping-top-container"
              [cdkDropListData]="centerColumns"
              cdkDropListOrientation="horizontal"
              [cdkDropListSortingDisabled]="
                isDisableColumnGrouping && draggingInGroupArea
              "
              (cdkDropListEntered)="onDropListEnter($event, 'center')"
              (cdkDropListSorted)="onSortGroup($event, 'center')"
              (cdkDropListDropped)="onDropGroup()"
              [style.maxWidth]="
                'calc(100% - ' +
                (rightPinnedHeader.offsetWidth + leftPinnedHeader.offsetWidth) +
                'px)'
              "
            >
              <div
                (cdkDragStarted)="
                  checkColumnGroupingStatus(col); dragStartOnGroup(col)
                "
                cdkDrag
                [cdkDragData]="col"
                *ngFor="
                  let col of centerColumns;
                  let i = index;
                  trackBy: trackById
                "
              >
                <ng-container
                  *ngTemplateOutlet="
                    headerCell;
                    context: {
                      $implicit: col,
                      index: i,
                      section: 'centerColumns'
                    }
                  "
                >
                </ng-container>
                <ng-template cdkDragPreview
                  ><div class="p-2 border d-flex gap-2">
                    <div><i class="bi bi-arrows-move"></i></div>
                    <div>{{ col.header }}</div>
                  </div>
                </ng-template>
                <ng-template cdkDragPlaceholder>
                  <div *ngIf="!draggingInGroupArea">
                    <div
                      *ngTemplateOutlet="
                        headerCell;
                        context: {
                          $implicit: col,
                          index: i,
                          section: 'centerColumns'
                        }
                      "
                    ></div>
                  </div>
                  <div
                    *ngIf="draggingInGroupArea"
                    class="d-flex gap-2 ms-2"
                    style="opacity: 0.6"
                  >
                    <ng-container *ngIf="col?.children?.length; else singleCol">
                      <ng-container
                        *ngFor="let child of col.children; let i = index"
                      >
                        <ng-container *ngIf="child?.isGroupable">
                          <ng-container
                            *ngTemplateOutlet="
                              topGroupingRowPlaceholder;
                              context: {
                                $implicit: child,
                                showChevron:
                                  col.children.length > 1 &&
                                  i != col.children.length - 1
                              }
                            "
                          ></ng-container>
                        </ng-container>
                      </ng-container>
                    </ng-container>

                    <ng-template #singleCol>
                      <ng-container *ngIf="col?.isGroupable">
                        <ng-container
                          *ngTemplateOutlet="
                            topGroupingRowPlaceholder;
                            context: {
                              $implicit: col,
                              showChevron: col?.children?.length > 1
                            }
                          "
                        ></ng-container>
                      </ng-container>
                    </ng-template>
                  </div>
                </ng-template>
              </div>
            </div>

            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <!-- Data Grid Right Pinned Header starts here -->
            <!-- ********************************************************************************* -->
            <!-- ********************************************************************************* -->
            <div
              cdkDropList
              id="right-pinned-header"
              cdkDropListConnectedTo="rows-grouping-top-container"
              cdkDropListOrientation="horizontal"
              class="data-grid-header right-pinned"
              (cdkDropListSorted)="onSortGroup($event, 'right')"
              (cdkDropListEntered)="onDropListEnter($event, 'right')"
              (cdkDropListDropped)="onDropGroup()"
              #rightPinnedHeader
              class="right-pinned-header d-flex"
              style="min-width: 0.2px"
            >
              <div
                cdkDrag
                [cdkDragData]="col"
                *ngFor="let col of rightPinnedColumns; let i = index"
              >
                <ng-container
                  *ngTemplateOutlet="
                    headerCell;
                    context: {
                      $implicit: col,
                      pinnedRight: true,
                      index: i,
                      section: ''
                    }
                  "
                ></ng-container>
                <ng-template cdkDragPreview
                  ><div class="p-2 border d-flex gap-2">
                    <div><i class="bi bi-arrows-move"></i></div>
                    <div>{{ col.header }}</div>
                  </div>
                </ng-template>
                <ng-template cdkDragPlaceholder>
                  <div *ngIf="!draggingInGroupArea">
                    <div
                      *ngTemplateOutlet="
                        headerCell;
                        context: {
                          $implicit: col,
                          index: i,
                          section: 'centerColumns'
                        }
                      "
                    ></div>
                  </div>
                  <div
                    *ngIf="draggingInGroupArea"
                    class="d-flex gap-2 ms-2"
                    style="opacity: 0.6"
                  >
                    <ng-container *ngIf="col?.children?.length; else singleCol">
                      <ng-container
                        *ngFor="let child of col.children; let i = index"
                      >
                        <ng-container
                          *ngTemplateOutlet="
                            topGroupingRowPlaceholder;
                            context: {
                              $implicit: child,
                              showChevron:
                                col.children.length > 1 &&
                                i != col.children.length - 1
                            }
                          "
                        ></ng-container>
                      </ng-container>
                    </ng-container>

                    <ng-template #singleCol>
                      <ng-container
                        *ngTemplateOutlet="
                          topGroupingRowPlaceholder;
                          context: {
                            $implicit: col,
                            showChevron: col?.children?.length > 1
                          }
                        "
                      ></ng-container>
                    </ng-template>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>

          <!--########################################################################################################################################################################################################################### -->
          <!--########################################################################################################################################################################################################################### -->
          <!-- Data Grid Body starts here -->
          <!--########################################################################################################################################################################################################################### -->
          <!--########################################################################################################################################################################################################################### -->

          <div
            class="data-grid-body-wrapper position-relative d-flex"
            [style.height]="bodyWrapperHeight"
            style="overflow-y: auto; overflow-x: hidden"
            #mainScroll
            (scroll)="onMainScroll($event)"
          >
            <!-- LEFT PINNED -->
            <div class="h-100">
              <div
                class="data-grid-body left-pinned-body w-100"
                style="overflow-y: hidden"
                [style.transform]="
                  'translateY(' + startIndex * rowHeight + 'px)'
                "
              >
                <ng-container *ngFor="let row of visibleRows; let i = index">
                  <ng-container
                    *ngTemplateOutlet="
                      rowCell;
                      context: {
                        $implicit: row,
                        columns: previewLeftPinnedColumns,
                        isEven: (startIndex + i) % 2 === 0,
                        isOdd: (startIndex + i) % 2 !== 0,
                        isLeft: true,
                        section: 'left'
                      }
                    "
                  ></ng-container>
                </ng-container>
              </div>
            </div>

            <!-- CENTER -->
            <div
              class="h-100"
              [style.width.px]="centerPinnedHeader.clientWidth"
            >
              <div
                class="data-grid-body center-scrollable"
                style="overflow-y: hidden; overflow-x: auto"
                [style.transform]="
                  'translateY(' + startIndex * rowHeight + 'px)'
                "
                #centerScrollableBody
                (scroll)="onCenterBodyScroll($event)"
              >
                <ng-container *ngFor="let row of visibleRows; let i = index">
                  <ng-container
                    *ngTemplateOutlet="
                      rowCell;
                      context: {
                        $implicit: row,
                        columns: previewCenterColumns,
                        isEven: (startIndex + i) % 2 === 0,
                        isOdd: (startIndex + i) % 2 !== 0,
                        section: 'center'
                      }
                    "
                  ></ng-container>
                </ng-container>
              </div>
            </div>

            <!-- RIGHT PINNED -->
            <div
              class="h-100 right-pinned-body-wrapper"
              *ngIf="hasRightPinnedColumns"
            >
              <div
                class="data-grid-body right-pinned-body w-100"
                style="overflow-y: hidden"
                [style.transform]="
                  'translateY(' + startIndex * rowHeight + 'px)'
                "
              >
                <ng-container *ngFor="let row of visibleRows; let i = index">
                  <ng-container
                    *ngTemplateOutlet="
                      rowCell;
                      context: {
                        $implicit: row,
                        columns: previewRightPinnedColumns,
                        isEven: (startIndex + i) % 2 === 0,
                        isOdd: (startIndex + i) % 2 !== 0,
                        section: 'right'
                      }
                    "
                  ></ng-container>
                </ng-container>
              </div>
            </div>

            <!-- Vertical Fake scroll Bar -->
          </div>
          <div
            (scroll)="onMainFakeScroll($event)"
            class="fake-scrollbar"
            [style.top.px]="
              showColumnsGrouping ? headerRowHeight * 3 : headerRowHeight * 2
            "
            #fakeScroll
            [style.height]="bodyWrapperHeight"
            style="
              overflow-y: auto;
              overflow-x: hidden;
              width: 17px;
              position: absolute;
              right: 0;
              background-color: f1f2f3;
              z-index: 10;
            "
          >
            <div [style.height.px]="bodyWrapperHeight"></div>
          </div>
        </div>

        <!-- Horizintal Fake Scrollbars -->
        <div class="d-flex justify-content-between">
          <div
            class="fake-horizintal-scrollbar"
            #fakeScroll
            [style.width.px]="leftPinnedHeader.offsetWidth"
            style="overflow-x: scroll"
          ></div>
          <div
            (scroll)="onHorizintalFakeScroll($event)"
            class="fake-horizintal-scrollbar"
            #horizintalFakeScroll
            [style.width.px]="centerPinnedHeader.offsetWidth"
          >
            <div [style.width.px]="centerPinnedHeader.scrollWidth"></div>
          </div>
          <div
            class="fake-horizintal-scrollbar"
            #fakeScroll
            [style.width.px]="rightPinnedHeader.offsetWidth"
            style="overflow-x: scroll"
          ></div>
        </div>
      </div>

      <!-- Side Menu Implemented Here -->
      <div
        *ngIf="showSideMenu"
        [style.width.px]="sideMenuVisible ? 280 : 30"
        class="right-menu"
        [style.backgroundColor]="sidemenuBackgroundColor"
      >
        <div class="h-100 d-flex flex-row-reverse">
          <div
            style="width: 30px"
            class="d-flex flex-column align-items-center cursor-pointer"
            [class.border-start]="sideMenuVisible"
          >
            <div
              (click)="toggleSideMenu('cols')"
              [class.bg-white]="
                currentOpenedSideMenue == 'cols' && sideMenuVisible
              "
              [class.border-bottom]="sideMenuVisible"
              class="columns-button d-flex flex-column align-items-center"
            >
              <div><i class="bi bi-ui-checks-grid"></i></div>
              <div class="side-menue-text">Columns</div>
            </div>

            <div
              (click)="toggleSideMenu('filtrs')"
              [class.bg-white]="
                currentOpenedSideMenue == 'filtrs' && sideMenuVisible
              "
              [class.border-bottom]="
                sideMenuVisible && currentOpenedSideMenue == 'filtrs'
              "
              class="columns-button d-flex flex-column align-items-center"
            >
              <div><i class="bi bi-filter"></i></div>
              <div class="side-menue-text">Filter</div>
            </div>
          </div>
          <div
            *ngIf="sideMenuVisible"
            [ngStyle]="{ width: sideMenuVisible ? '250px' : '' }"
          >
            <div class="h-100">
              <ng-container
                *ngIf="currentOpenedSideMenue == 'cols' && sideMenuVisible"
              >
                <ng-container *ngTemplateOutlet="columnPannel"></ng-container>
                <!-- Column Items -->
                <div class="column-panel-body px-3">
                  <ng-container *ngFor="let col of columns">
                    <ng-container
                      *ngTemplateOutlet="columnPanelItem; context: { col: col }"
                    ></ng-container>
                  </ng-container>
                </div>
                <hr />

                <div class="side-menu-row-groups" style="height: 30%">
                  <ng-container
                    *ngTemplateOutlet="sideMenuRowGroups"
                  ></ng-container>
                </div>
              </ng-container>
              <ng-container
                *ngIf="currentOpenedSideMenue == 'filtrs' && sideMenuVisible"
              >
                <ng-container *ngTemplateOutlet="sideFilters"></ng-container>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div [style.height.px]="footerRowHeight" class="border-top">
      <!-- Rows: <span class="fw-500 ms-1">{{ dataSet.length }}</span> -->

      <div
        class="pagination-container"
        [style.height.px]="footerRowHeight"
        [style.padding.px]="footerPadding"
      >
        <div class="page-size">
          <select
            [(ngModel)]="paginationConfig.limit"
            (change)="onPageSizeChange()"
          >
            <option *ngFor="let size of pageSizeOptions" [value]="size">
              {{ size }}
            </option>
          </select>
          <span class="separator"> per page </span>
        </div>

        <div class="page-info">
          Results: {{ startIndex + 1 }}-{{ endIndex }} of
          {{ paginationConfig.totalResults }}
        </div>

        <div class="page-buttons">
          <button
            (click)="goToPage(paginationConfig.page - 1)"
            [disabled]="paginationConfig.page === 1"
          >
            ‹
          </button>

          <ng-container *ngFor="let page of visiblePages">
            <button
              *ngIf="page !== '...'"
              (click)="goToPage(page)"
              [class.active]="page === paginationConfig.page"
            >
              {{ page }}
            </button>
            <span *ngIf="page === '...'">...</span>
          </ng-container>

          <button
            (click)="goToPage(paginationConfig.page + 1)"
            [disabled]="paginationConfig.page === paginationConfig.totalResults"
          >
            ›
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<!-- Header Cell Template -->
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<!-- ------------------------------------------------------------------------------------------------------------------------ -->

<ng-template
  #headerCell
  let-col
  let-pinnedRight="pinnedRight"
  let-i="index"
  let-sections="section"
  let-calledFromNestedPlaceholder="calledFromNestedPlaceholder"
>
  <div>
    <!-- Group Header -->
    <ng-container *ngIf="col.children?.length > 0; else flatHeader">
      <div cdkDroplistGroup class="group-column-wrapper">
        <!-- Parent Header -->
        <div
          *ngIf="shouldTheGroupHeaderShow(col)"
          class="header-cell group-header"
          [style.height.px]="headerRowHeight"
          [style.min-height.px]="headerRowHeight"
          [style.max-height.px]="headerRowHeight"
          [class.border-right]="showVerticalBorder"
          [style.gridColumn]="'span ' + col.children.length"
          [style.fontWeight]="headerFontWeight"
          [class.flex-row-reverse]="pinnedRight"
          [class.justify-content-end]="pinnedRight"
          style="grid-row: 1"
        >
          <div
            class="group-header-content"
            [title]="col.header"
            [class.ms-2]="pinnedRight"
          >
            {{ col.header }}
          </div>
          <div
            class="resize-handle"
            (dblclick)="autosizeColumn(col.children)"
            (mousedown)="onResizeGroup($event, col, pinnedRight)"
          >
            |
          </div>
        </div>

        <!-- Child Headers and Filters -->

        <div
          class="d-flex"
          cdkDropList
          cdkDropListOrientation="horizontal"
          [cdkDropListData]="col.children"
          (cdkDropListSorted)="onChildDroplistSorted($event, sections)"
          (cdkDropListDropped)="onChildDroplistDroped($event)"
          [cdkDropListSortingDisabled]="false"
          [cdkDropListConnectedTo]="'rows-grouping-top-container'"
        >
          <div
            cdkDrag
            [cdkDragData]="child"
            *ngFor="let child of col.children; let i = index"
          >
            <!-- Child Header -->
            <ng-container *ngIf="child.is_visible && !child['isRowGrouped']">
              <div
                cdkDragHandle
                class="header-cell one-row-header-cells"
                [class.border-right]="showVerticalBorder"
                [attr.field]="child.field"
                [style.width.px]="child.width"
                [style.min-width.px]="child.width"
                [style.min-height.px]="headerRowHeight"
                [style.max-height.px]="headerRowHeight"
                [style.fontWeight]="headerFontWeight"
                style="grid-row: 2"
              >
                <div
                  class="d-flex justify-content-between h-100 align-items-center w-100"
                >
                  <div
                    class="d-flex justify-content-between w-100"
                    [class.flex-row-reverse]="pinnedRight"
                  >
                    <div
                      class="text-ellipsis h-100 d-flex align-items-center"
                      [title]="col.header"
                      [class.w-100]="pinnedRight"
                    >
                      {{ child.header }}
                    </div>

                    <div
                      class="position-relative d-flex"
                      [class.flex-row-reverse]="pinnedRight"
                    >
                      <div
                        class="three-dots p-1"
                        (click)="openThreeDotsMenu($event, child)"
                        style="cursor: pointer"
                      >
                        <i class="bi bi-three-dots-vertical"></i>
                      </div>

                      <!-- Only show menu if this column is active -->
                      <div
                        class="position-absolute"
                        *ngIf="activeCol === child"
                        style="top: -50%; z-index: 21"
                        [style.left.px]="
                          !child.pinned ? 0 : -fakeScrollbarScrollLeft
                        "
                      >
                        <ng-container
                          *ngTemplateOutlet="
                            columnMenu;
                            context: { col: child }
                          "
                        ></ng-container>
                      </div>

                      <div
                        class="resize-handle"
                        (dblclick)="autosizeColumn(child)"
                        (mousedown)="onResizeColumn($event, child)"
                      >
                        |
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Filter Cell -->
              <div
                *ngIf="showFilterRow"
                [style.backgroundColor]="headerBackgroundColor"
                class="header-cell filter-cell"
                [class.border-right]="showVerticalBorder"
                [attr.field]="child.field"
                [style.width.px]="child.width"
                [style.min-width.px]="child.width"
                [style.height.px]="headerRowHeight"
                [style.min-height.px]="headerRowHeight"
                [style.max-height.px]="headerRowHeight"
                [class.border-right]="showVerticalBorder"
                style="grid-row: 3"
              >
                <div
                  class="header-cell filter-cell"
                  [attr.field]="col.field"
                  [style.width.px]="col.width"
                  [style.min-width.px]="col.width"
                  [style.height.px]="headerRowHeight"
                  [style.min-height.px]="headerRowHeight"
                  [style.max-height.px]="headerRowHeight"
                >
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    placeholder="Filter"
                    [(ngModel)]="col.filterValue"
                    (ngModelChange)="onFilterChange(col)"
                  />
                  <span
                    class="filter-icon-wrapper"
                    (click)="activeFilterCell = child; activeCol = null"
                    ><i class="bi bi-filter"></i
                  ></span>

                  <div
                    class="position-absolute"
                    *ngIf="activeFilterCell === child"
                    style="top: 100%; right: 0; z-index: 10; left: 0"
                  >
                    <ng-container
                      *ngTemplateOutlet="filterMenu; context: { col: child }"
                    ></ng-container>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template cdkDragPreview
              ><div class="p-2 border d-flex gap-2">
                <div
                  *ngIf="
                    !draggingInGroupArea ||
                    (child.isGroupable && draggingInGroupArea)
                  "
                >
                  <i class="bi bi-arrows-move"></i>
                </div>
                <div *ngIf="draggingInGroupArea && !child.isGroupable">
                  <i class="bi bi-ban"></i>
                </div>
                <div>{{ child.header }}</div>
              </div>
            </ng-template>
            <ng-template cdkDragPlaceholder>
              <div *ngIf="!draggingInGroupArea" class="position-relative">
                <div
                  *ngTemplateOutlet="
                  childHeaderPlaceholder;
                  context: {
                    $implicit: child,
                    index: i,
                    sections: sections,
                    calledFromNestedPlaceholder: true,
                  }
                "
                ></div>
              </div>
              <div
                *ngIf="draggingInGroupArea && child?.isGroupable"
                class="d-flex gap-2 ms-2"
                style="opacity: 0.6"
              >
                <ng-container
                  *ngTemplateOutlet="
                    topGroupingRowPlaceholder;
                    context: {
                      $implicit: child,
                      showChevron: false,
                      pinnedRight: pinnedRight,
                      sections: sections,
                      index: i
                    }
                  "
                ></ng-container>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Flat Header || Single Header Cell-->
    <ng-template #flatHeader>
      <div class="group-column-wrapper">
        <!-- Full-height Header Cell (spans 2 rows visually) -->
        <div
          class="header-cell one-row-header-cells"
          [attr.field]="col.field"
          [style.width.px]="col.width"
          [style.min-width.px]="col.width"
          [class.border-right]="showVerticalBorder"
          [style.min-height.px]="
            showColumnsGrouping ? headerRowHeight * 2 : headerRowHeight
          "
          [style.height.px]="
            showColumnsGrouping ? headerRowHeight * 2 : headerRowHeight
          "
          [style.fontWeight]="headerFontWeight"
          style="grid-row: 1 / span 2"
        >
          <div
            class="d-flex justify-content-between h-100 align-items-center w-100"
          >
            <div
              class="d-flex justify-content-between w-100"
              [class.flex-row-reverse]="pinnedRight"
            >
              <div
                class="text-ellipsis h-100 d-flex align-items-center w-100"
                [title]="col.header"
              >
                {{ col.header }}
              </div>

              <div
                class="position-relative d-flex"
                [class.flex-row-reverse]="pinnedRight"
              >
                <div
                  class="three-dots p-1"
                  (click)="activeCol = col; activeFilterCell = null"
                  style="cursor: pointer"
                >
                  <i class="bi bi-three-dots-vertical"></i>
                </div>

                <!-- Only show menu if this column is active -->
                <div
                  class="position-absolute"
                  *ngIf="activeCol === col"
                  style="top: -50%; z-index: 21"
                  [style.left.px]="
                    !col?.pinned ? 0 : -centerPinnedHeader.scrollLeft
                  "
                >
                  <ng-container
                    *ngTemplateOutlet="columnMenu; context: { col: col }"
                  ></ng-container>
                </div>

                <div
                  class="resize-handle"
                  [class.w-100]="col.pinned == 'right'"
                  (dblclick)="autosizeColumn(col)"
                  (mousedown)="onResizeColumn($event, col)"
                >
                  |
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Filter Cell -->
        <div
          *ngIf="showFilterRow"
          [style.backgroundColor]="headerBackgroundColor"
          class="header-cell filter-cell"
          [class.border-right]="showVerticalBorder"
          [attr.field]="col.field"
          [style.width.px]="col.width"
          [style.min-width.px]="col.width"
          [style.height.px]="headerRowHeight"
          [style.min-height.px]="headerRowHeight"
          [style.max-height.px]="headerRowHeight"
        >
          <input
            type="text"
            class="form-control form-control-sm"
            placeholder="Filter"
            [(ngModel)]="col.filterValue"
            (ngModelChange)="onFilterChange(col)"
          />
          <span
            class="filter-icon-wrapper"
            (click)="activeFilterCell = col; activeCol = null"
            ><i class="bi bi-filter"></i
          ></span>

          <div
            class="position-absolute"
            *ngIf="activeFilterCell === col"
            style="top: 100%; right: 0; z-index: 10; left: 0"
          >
            <ng-container
              *ngTemplateOutlet="filterMenu; context: { col: col }"
            ></ng-container>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</ng-template>

<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- Body Cell Template -->
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<ng-template
  #rowCell
  let-row
  let-columns="columns"
  let-isEven="isEven"
  let-isOdd="isOdd"
  let-isLeftSection="isLeft"
  let-section="section"
>
  <!-- Check if row is a group -->
  <ng-container
    *ngTemplateOutlet="groupRowTemplate; context: { $implicit: row, depth: 0 }"
  ></ng-container>
  <ng-template #groupRowTemplate let-row let-depth="depth">
    <ng-container *ngIf="row.isGroup; else regularRow">
      <!-- Group Header -->
      <div
        class="group-header-row border-bottom d-flex"
        [style.height.px]="rowHeight"
      >
        <div
          *ngIf="section == 'left'"
          class="h-100"
          [style.width.px]="leftPinnedHeader.offsetWidth"
        >
          <div
            style="width: 50px"
            class="d-flex align-items-center justify-content-center h-100 border-end"
            [style.backgroundColor]="checkboxesBackgroundColor"
          >
            <input style="width: 16px; height: 16px" type="checkbox" />
          </div>
        </div>

        <div
          *ngIf="section == 'center'"
          [style.width.px]="centerPinnedHeader.scrollWidth"
          class="d-flex align-items-center ps-2"
        >
          <div
            class="d-flex align-items-center justify-content-between"
            [style.paddingLeft.px]="depth > 0 ? depth * 16 : 0"
          >
            <span class="me-2 filter-icon-wrapper" (click)="toggleExpand(row)">
              <i
                class="bi"
                [ngClass]="
                  row.isExpand ? 'bi-chevron-down' : 'bi-chevron-right'
                "
              ></i>
            </span>
            <strong> {{ row.groupValue }} ({{ countLeafRows(row) }}) </strong>
          </div>
        </div>

        <div
          *ngIf="section == 'right'"
          [style.width.px]="rightPinnedHeader.offsetWidth"
        ></div>
      </div>

      <!-- Recursive Children -->
      <div class="group-children" *ngIf="row.isExpand">
        <ng-container *ngFor="let child of row.children; let i = index">
          <ng-container *ngIf="child.isGroup; else dataRow">
            <!-- Recursive call for nested group -->
            <ng-container
              *ngTemplateOutlet="
                groupRowTemplate;
                context: { $implicit: child, depth: depth + 1 }
              "
            ></ng-container>
          </ng-container>

          <ng-template #dataRow>
            <!-- Regular data row -->
            <ng-container
              *ngTemplateOutlet="
                rowCell;
                context: {
                  $implicit: child,
                  columns: columns,
                  isEven: i % 2 === 0,
                  isOdd: i % 2 !== 0,
                  isLeft: isLeftSection
                }
              "
            ></ng-container>
          </ng-template>
        </ng-container>
      </div>
    </ng-container>
  </ng-template>

  <!-- Regular row (not a group) -->
  <ng-template #regularRow>
    <div
      [style.height.px]="rowHeight"
      class="data-grid-row"
      [class.even-row]="isEven"
      [class.odd-row]="isOdd"
      [class.hovered-row]="hoveredRowId === (row._id || row.id)"
      (mouseenter)="onRowHover(row)"
      (mouseleave)="onRowLeave()"
      [ngStyle]="{
        'background-color':
          hoveredRowId === (row._id || row.id)
            ? rowHoverColor
            : isRowSelected(row)
            ? checkedRowBackgroundColor
            : isEven
            ? evenRowsBackgroundColor
            : oddRowsBackgroundColor
      }"
    >
      <div
        [style.backgroundColor]="checkboxesBackgroundColor"
        class="select-all-checkbox-cell"
        *ngIf="isLeftSection"
      >
        <input
          *ngIf="hasAnyVisibleColumn"
          type="checkbox"
          [checked]="isRowSelected(row)"
          (change)="toggleRowSelection(row)"
        />
      </div>

      <!-- Render all columns -->
      <ng-container *ngFor="let col of columns">
        <ng-container *ngIf="col.children?.length > 0; else flatColumn">
          <ng-container *ngFor="let child of col.children">
            <ng-container *ngIf="child?.is_visible && !child?.isRowGrouped">
              <ng-container
                *ngTemplateOutlet="
                  cellTemplate;
                  context: { col: child, row: row }
                "
              ></ng-container>
            </ng-container>
          </ng-container>
        </ng-container>

        <ng-template #flatColumn>
          <ng-container
            *ngTemplateOutlet="cellTemplate; context: { col: col, row: row }"
          ></ng-container>
        </ng-template>
      </ng-container>
    </div>
  </ng-template>
</ng-template>

<!-- Actual Cell is Here -->
<ng-template #cellTemplate let-col="col" let-row="row">
  <div
    (click)="disableEdit(); setActiveCell(row, col)"
    [style.fontWeight]="bodyFontWeight"
    [class.border-right]="showVerticalBorder"
    class="cell"
    [attr.field]="col.field"
    [style.width.px]="col.width"
    [style.min-width.px]="col.width"
    [style.fontSize.px]="bodyTextFontsSize"
    [class.active-cell]="isActiveCell(row, col) && !isEditing(row, col)"
    (dblclick)="enableEdit(row, col)"
  >
    <div class="table-cell" [class.active-for-editing]="isEditing(row, col)">
      <div (click)="$event.stopPropagation()" *ngIf="isEditing(row, col); else viewMode">
        <ng-container [ngSwitch]="col.type">
          <!-- Text Input -->
          <input
            [style.height.px]="rowHeight - 10"
            *ngSwitchCase="'input'"
            type="text"
            [(ngModel)]="row[col.field]"
            (blur)="disableEdit()"
            autofocus
            class="form-control form-control-sm"
          />

          <!-- Number Input -->
          <input
            [style.height.px]="rowHeight - 8"
            *ngSwitchCase="'number'"
            type="number"
            [(ngModel)]="row[col.field]"
            (blur)="disableEdit()"
            autofocus
            class="form-control form-control-sm"
          />

          <!-- Date Input -->
          <input
            [style.height.px]="rowHeight - 8"
            *ngSwitchCase="'date'"
            type="date"
            [(ngModel)]="row[col.field]"
            (blur)="disableEdit()"
            autofocus
            class="form-control form-control-sm"
          />

          <!-- Dropdown -->
          <!-- <select
            *ngSwitchCase="'dropdown'"
            [(ngModel)]="row[col.field]"
            (blur)="disableEdit()"
            autofocus
            class="form-select form-select-sm"
          > -->
            <!-- <option *ngFor="let option of col.options" [value]="option.value">
              {{ option.label }}
            </option>
          </select> -->

          <!-- Default fallback -->
          <input
            *ngSwitchDefault
            [style.height.px]="rowHeight - 10"
            [style.maxHeight.px]="rowHeight - 10"
            #textInput
            type="text"
            [(ngModel)]="row[col.field]"
            (blur)="disableEdit()"
            (keydown.enter)="textInput.blur()"
            autofocus
            class="form-control form-control-sm"
          />
        </ng-container>
      </div>

      <!-- Display mode -->
      <ng-template #viewMode>
        <div class="text-ellipsis w-100">{{ getNestedValue(row, col.field) || "-" }}</div>
      </ng-template>
    </div>
  </div>
</ng-template>

<!-- Headers Action List On clicking three dots -->

<ng-template #columnMenu let-col="col">
  <div
    class="column-menu"
    [class.visually-hidden]="isMenueHidden"
    *ngIf="activeCol"
    [style.backgroundColor]="dropdownsBackgroundColor"
  >
    <!-- Sort Ascending -->
    <div class="column-menu-item" (click)="sortAsc(activeCol)">
      <i class="bi bi-sort-alpha-down me-2"></i> Sort Ascending
    </div>

    <!-- Sort Descending -->
    <div class="column-menu-item" (click)="sortDesc(activeCol)">
      <i class="bi bi-sort-alpha-up me-2"></i> Sort Descending
    </div>

    <!-- Pin Column with Submenu -->
    <div class="column-menu-item position-relative pin-parent">
      <div class="d-flex justify-content-between align-items-center w-100">
        <span> <i class="bi bi-pin-angle-fill me-2"></i> Pin Column </span>
        <i class="bi bi-chevron-right ms-2"></i>
      </div>

      <!-- Submenu -->
      <div
        class="column-submenu"
        [style.backgroundColor]="dropdownsBackgroundColor"
      >
        <div
          class="column-menu-item"
          (click)="updateColumnPinInSourceByField(activeCol, null)"
        >
          <i class="bi bi-check me-2" *ngIf="!activeCol.pinned"></i>
          <span [class.ms-4]="activeCol.pinned !== null">Unpin</span>
        </div>
        <div
          class="column-menu-item"
          (click)="updateColumnPinInSourceByField(activeCol, 'left')"
        >
          <i class="bi bi-check me-2" *ngIf="activeCol.pinned == 'left'"></i>
          <span [class.ms-4]="activeCol.pinned !== 'left'">Pin Left</span>
        </div>
        <div
          class="column-menu-item"
          (click)="updateColumnPinInSourceByField(activeCol, 'right')"
        >
          <i class="bi bi-check me-2" *ngIf="activeCol.pinned == 'right'"></i>
          <span [class.ms-4]="activeCol.pinned !== 'right'">Pin Right</span>
        </div>
      </div>
    </div>

    <!-- Autosize This Column -->
    <div class="column-menu-item" (click)="autosizeColumn(activeCol)">
      <i class="bi bi-arrows-expand me-2"></i> Autosize This Column
    </div>

    <!-- Autosize All Columns -->
    <div class="column-menu-item" (click)="autosizeAllColumns()">
      <i class="bi bi-arrows-angle-expand me-2"></i> Autosize All Columns
    </div>

    <!-- Group By -->
    <div class="column-menu-item" (click)="groupBy(activeCol)">
      <i class="bi bi-diagram-3 me-2"></i> Group by {{ col.header }}
    </div>

    <!-- Choose Columns -->
    <div class="column-menu-item" (click)="chooseColumns()">
      <i class="bi bi-ui-checks-grid me-2"></i> Choose Columns
    </div>

    <!-- Reset Columns -->
    <div class="column-menu-item" (click)="resetColumns()">
      <i class="bi bi-arrow-counterclockwise me-2"></i> Reset Columns
    </div>
  </div>
</ng-template>

<!-- Filter Menue -->
<ng-template #filterMenu let-col="col">
  <div
    class="filter-menu-container filter-menu"
    [style.backgroundColor]="dropdownsBackgroundColor"
  >
    <!-- Dropdown Type -->
    <ng-container *ngIf="col.type === 'dropdown'; else textFilter">
      <div class="filter-dropdown-section p-1">
        <input
          type="text"
          class="form-control form-control-sm mb-2"
          placeholder="Search..."
          [(ngModel)]="col.searchValue"
        />

        <div class="form-check mb-1">
          <input
            class="form-check-input"
            type="checkbox"
            [(ngModel)]="col.selectAll"
            (change)="toggleSelectAll(col)"
            id="selectAll_{{ col.field }}"
          />
          <label class="form-check-label" for="selectAll_{{ col.field }}">
            Select All
          </label>
        </div>

        <div class="dropdown-options">
          <div
            class="form-check mb-1"
            *ngFor="let option of col.dropdownValues | filter : col.searchValue"
          >
            <input
              class="form-check-input"
              type="checkbox"
              [value]="option"
              [(ngModel)]="col.selectedOptions[option]"
              [id]="col.field + '_' + option"
            />
            <label class="form-check-label" [for]="col.field + '_' + option">
              {{ option }}
            </label>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Text Filter Section -->
    <ng-template #textFilter>
      <div class="filter-text-section">
        <div class="form-group mb-2">
          <select
            class="form-select form-select-sm"
            [(ngModel)]="col!.query!.first_condition"
          >
            <option value="contains">Contains</option>
            <option value="equals">Equals</option>
            <option value="startsWith">Starts With</option>
            <option value="endsWith">Ends With</option>
          </select>
        </div>

        <input
          type="text"
          class="form-control form-control-sm mb-3"
          placeholder="Value"
          [(ngModel)]="col!.query!.firt_value"
        />

        <ng-container *ngIf="col?.query?.firt_value">
          <div class="form-group mb-2">
            <div class="form-check form-check-inline">
              <input
                class="form-check-input filter-radio-inputs"
                type="radio"
                name="condition"
                [(ngModel)]="col!.query.condition"
                value="and"
                id="and_{{ col.field }}"
              />
              <label class="form-check-label" for="and_{{ col.field }}"
                >AND</label
              >
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input filter-radio-inputs"
                type="radio"
                name="condition"
                [(ngModel)]="col!.query.condition"
                value="or"
                id="or_{{ col.field }}"
              />
              <label class="form-check-label" for="or_{{ col.field }}"
                >OR</label
              >
            </div>
          </div>

          <div class="form-group mb-2">
            <select
              class="form-select form-select-sm"
              [(ngModel)]="col!.query.second_condition"
            >
              <option value="contains">Contains</option>
              <option value="equals">Equals</option>
              <option value="startsWith">Starts With</option>
              <option value="endsWith">Ends With</option>
            </select>
          </div>

          <input
            type="text"
            class="form-control form-control-sm mb-2"
            placeholder="Second Value"
            [(ngModel)]="col!.query.second_value"
          />
        </ng-container>
      </div>
    </ng-template>

    <!-- Actions -->
    <div class="filter-menu-actions d-flex justify-content-end mt-2">
      <button class="btn btn-sm btn-secondary" (click)="clearFilter(col)">
        Reset
      </button>
    </div>
  </div>
</ng-template>

<!-- Side Menue -->

<!-- Column Pannel / Pivot Mode / Searching -->

<ng-template #columnPannel>
  <div class="column-panel-header">
    <!-- Pivot Toggle -->
    <div
      class="form-check form-switch d-flex align-items-center mb-2 pivot-mode px-5 ms-2"
    >
      <input
        class="form-check-input me-2"
        type="checkbox"
        id="pivotToggle"
        [(ngModel)]="pivotMode"
      />
      <label class="form-check-label" for="pivotToggle">Pivot Mode</label>
    </div>

    <!-- Select All & Search -->
    <div class="d-flex align-items-center mb-2 px-3">
      <span class="filter-icon-wrapper me-2" *ngIf="showColumnsGrouping">
        <i
          class="bi bi-chevron-right toggle-icon"
          [ngClass]="{
            bi: true,
            'bi-chevron-down': accordionState === 'all',
            'bi-dash': accordionState === 'some',
            'bi-chevron-right': accordionState === 'none'
          }"
          (click)="toggleAllAccordions()"
        ></i>
      </span>
      <input
        type="checkbox"
        class="form-check-input me-2"
        [checked]="allColumnsSelected()"
        (change)="toggleAllColumnsVisibility()"
      />
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Search columns..."
        [(ngModel)]="columnSearch"
      />
    </div>

    <!-- Separator -->
    <hr class="my-2" />
  </div>
</ng-template>

<!-- Column Panel Item Template -->
<ng-template #columnPanelItem let-col="col">
  <!-- Group Column -->
  <ng-container *ngIf="col.children?.length">
    <div class="column-group d-flex align-items-center mb-2">
      <span class="filter-icon-wrapper me-2">
        <i
          class="bi bi-chevron-right toggle-icon"
          [class.rotate]="col.expanded"
          (click)="col.expanded = !col.expanded"
        ></i>
      </span>
      <input
        type="checkbox"
        class="form-check-input me-2"
        [id]="'group_' + col.header"
        [checked]="isColumnVisible(col)"
        (change)="toggleGroupVisibility(col)"
      />
      <i class="bi bi-grid-3x2-gap me-2 grab-icon"></i>
      <label
        class="d-flex align-items-center mb-0 w-100"
        [for]="'group_' + col.header"
        style="cursor: pointer"
      >
        <span class="text-truncate">{{ col.header }}</span>
      </label>
    </div>
    <div *ngIf="col.expanded" class="ps-4">
      <ng-container *ngFor="let child of col.children">
        <ng-container
          *ngTemplateOutlet="columnPanelItem; context: { col: child }"
        ></ng-container>
      </ng-container>
    </div>
  </ng-container>

  <!-- Leaf Column -->
  <ng-container *ngIf="!col.children?.length">
    <div class="d-flex align-items-center mb-2">
      <span class="me-2" style="width: 1.5rem"></span>
      <input
        type="checkbox"
        class="form-check-input me-2"
        [(ngModel)]="col.is_visible"
        [id]="'col_' + col.field"
        (change)="refreshHeaders()"
      />
      <i class="bi bi-grid-3x2-gap me-2 grab-icon"></i>
      <label
        class="d-flex align-items-center mb-0 w-100"
        [for]="'col_' + col.field"
        style="cursor: pointer"
      >
        <span class="text-truncate">{{ col.header }}</span>
      </label>
    </div>
  </ng-container>
</ng-template>

<!-- Columns Side Filter -->
<ng-template #sideFilters>
  <div class="py-3 px-2 pe-3 h-100">
    <div class="d-flex align-items-center mb-2">
      <span class="filter-icon-wrapper me-2">
        <i
          class="bi bi-chevron-right toggle-icon"
          [ngClass]="{
            bi: true,
            'bi-chevron-down': filterAccordionState === 'all',
            'bi-dash': filterAccordionState === 'some',
            'bi-chevron-right': filterAccordionState === 'none'
          }"
          (click)="toggleAllFilterAccordions()"
        ></i>
      </span>
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Search..."
        [(ngModel)]="columnSearch"
      />
    </div>
    <div class="overflow-auto side-filter-columns-wrapper">
      <ng-container *ngFor="let col of columns">
        <ng-container
          *ngTemplateOutlet="filterPannelItem; context: { col: col }"
        ></ng-container>
      </ng-container>
    </div>
  </div>
</ng-template>

<ng-template #filterPannelItem let-col="col">
  <!-- Group Column -->
  <ng-container *ngIf="col.children?.length">
    <div class="column-group d-flex align-items-center mb-2">
      <!-- Chevron toggle -->
      <span class="filter-icon-wrapper me-2">
        <i
          class="bi bi-chevron-right toggle-icon"
          [class.rotate]="col.expandedFilter"
          (click)="col.expandedFilter = !col.expandedFilter"
        ></i>
      </span>

      <!-- Group label toggle -->
      <label
        class="d-flex align-items-center mb-0 w-100"
        style="cursor: pointer"
        (click)="col.expandedFilter = !col.expandedFilter"
      >
        <span class="fw-bold text-truncate">{{ col.header }}</span>
      </label>
    </div>

    <!-- Children columns -->
    <div *ngIf="col.expandedFilter" class="ps-4">
      <ng-container *ngFor="let child of col.children">
        <ng-container
          *ngTemplateOutlet="filterPannelItem; context: { col: child }"
        ></ng-container>
      </ng-container>
    </div>
  </ng-container>

  <!-- Leaf Column -->
  <ng-container *ngIf="!col.children?.length">
    <div class="d-flex align-items-center mb-2">
      <span
        class="me-2 filter-icon-wrapper me-2"
        (click)="col.expandedFilter = !col.expandedFilter"
      >
        <i
          class="bi bi-chevron-right toggle-icon"
          [class.rotate]="col.expandedFilter"
        ></i>
      </span>

      <label
        class="d-flex align-items-center mb-0 w-100"
        style="cursor: pointer"
        (click)="col.expandedFilter = !col.expandedFilter"
      >
        <span class="text-truncate fw-bold">{{ col.header }}</span>
      </label>
    </div>

    <!-- Show filter when expanded -->
    <div *ngIf="col.expandedFilter" class="ps-4 pe-3">
      <ng-container
        *ngTemplateOutlet="sideNestedFilter; context: { col: col }"
      ></ng-container>
    </div>
  </ng-container>
</ng-template>

<!-- Side Nested Filters -->
<ng-template #sideNestedFilter let-col="col">
  <div class="">
    <!-- Dropdown Type -->
    <ng-container *ngIf="col.type === 'dropdown'; else textFilter">
      <div class="p-1">
        <input
          type="text"
          class="form-control form-control-sm mb-2"
          placeholder="Search..."
          [(ngModel)]="col.searchValue"
        />

        <div>
          <div class="form-check mb-1 ms-1">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="col.selectAll"
              (change)="toggleSelectAll(col)"
              id="selectAll_{{ col.field }}"
            />
            <label class="form-check-label" for="selectAll_{{ col.field }}">
              Select All
            </label>
          </div>

          <div class="dropdown-options">
            <div
              class="form-check mb-1 ms-1"
              *ngFor="let option of col.column_dropdown_value"
            >
              <input
                class="form-check-input"
                type="checkbox"
                [value]="option.id || option._id || option"
                [id]="option.value + '_' + option"
              />
              <label
                class="form-check-label"
                [for]="option.value + '_' + option"
              >
                {{ option.value || option }}
              </label>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Text Filter Section -->
    <ng-template #textFilter>
      <div class="filter-text-section">
        <div class="form-group mb-2">
          <select
            class="form-select form-select-sm"
            [(ngModel)]="col!.query!.first_condition"
          >
            <option value="contains">Contains</option>
            <option value="equals">Equals</option>
            <option value="startsWith">Starts With</option>
            <option value="endsWith">Ends With</option>
          </select>
        </div>

        <input
          [type]="col.type == 'date' ? 'date' : 'text'"
          class="form-control form-control-sm mb-3"
          placeholder="Value"
          [(ngModel)]="col!.query!.firt_value"
        />

        <ng-container *ngIf="col?.query?.firt_value">
          <div class="form-group mb-2">
            <div class="form-check form-check-inline">
              <input
                class="form-check-input filter-radio-inputs"
                type="radio"
                name="condition"
                [(ngModel)]="col!.query.condition"
                value="and"
                id="and_{{ col.field }}"
              />
              <label class="form-check-label" for="and_{{ col.field }}"
                >AND</label
              >
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input filter-radio-inputs"
                type="radio"
                name="condition"
                [(ngModel)]="col!.query.condition"
                value="or"
                id="or_{{ col.field }}"
              />
              <label class="form-check-label" for="or_{{ col.field }}"
                >OR</label
              >
            </div>
          </div>

          <div class="form-group mb-2">
            <select
              class="form-select form-select-sm"
              [(ngModel)]="col!.query.second_condition"
            >
              <option value="contains">Contains</option>
              <option value="equals">Equals</option>
              <option value="startsWith">Starts With</option>
              <option value="endsWith">Ends With</option>
            </select>
          </div>

          <input
            [type]="col.type == 'date' ? 'date' : 'text'"
            class="form-control form-control-sm mb-2"
            placeholder="Second Value"
            [(ngModel)]="col!.query.second_value"
          />
        </ng-container>
      </div>
    </ng-template>
  </div>
</ng-template>

<!-- Centr Overlay for showing the chose columns -->

<div *ngIf="showColumnPanel" class="custom-modal-overlay">
  <div
    class="custom-modal-content"
    [style.backgroundColor]="dropdownsBackgroundColor"
    (click)="$event.stopPropagation()"
  >
    <ng-container *ngTemplateOutlet="modalColumnPannel"></ng-container>
  </div>
</div>

<!-- The existing ng-template you provided -->
<ng-template #modalColumnPannel>
  <div class="column-panel-header">
    <div
      class="d-flex justify-content-between align-items-center px-2 ps-3 rounded-top-2 moda-header"
      [style.height.px]="48"
    >
      Choose Columns
      <span class="filter-icon-wrapper" (click)="closeModalColumnPanel()"
        ><i class="bi bi-x"></i
      ></span>
    </div>
    <hr class="my-0" />
    <div>
      <div class="d-flex align-items-center px-2 pe-3" [style.height.px]="48">
        <span class="filter-icon-wrapper me-2" *ngIf="showColumnsGrouping">
          <i
            class="bi bi-chevron-right toggle-icon"
            [ngClass]="{
              bi: true,
              'bi-chevron-down': accordionState === 'all',
              'bi-dash': accordionState === 'some',
              'bi-chevron-right': accordionState === 'none'
            }"
            (click)="toggleAllAccordions()"
          ></i>
        </span>
        <input
          type="checkbox"
          class="form-check-input me-2"
          [checked]="allColumnsSelected()"
          (change)="toggleAllColumnsVisibility()"
        />
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Search columns..."
          [(ngModel)]="columnSearch"
        />
      </div>

      <hr class="mt-0 mb-1" />
      <div class="px-2 overlay-scrollable">
        <ng-container *ngFor="let col of columns">
          <ng-container
            *ngTemplateOutlet="columnPanelItem; context: { col: col }"
          ></ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #sideMenuRowGroups>
  <div class="d-flex flex-column h-100">
    <div class="px-3 h-100">
      <div class="d-flex gap-3 mb-4">
        <i class="bi bi-justify"></i>
        <span>Row Groups</span>
      </div>
      <div class="h-50">
        <div
          class="px-3 py-2 border-dashed h-100 d-flex justify-content-center align-items-center"
          style="font-size: 14px"
        >
          Drag here to set row Groups
        </div>
      </div>
    </div>

    <hr class="mt-4" />

    <div class="px-3 h-100">
      <div class="d-flex gap-3 mb-4">
        <i class="bi bi-justify"></i>
        <span>Values</span>
      </div>
      <div class="h-50 d-flex">
        <div
          class="px-3 py-2 border-dashed h-100 d-flex justify-content-center align-items-center"
          style="font-size: 14px"
        >
          Drag here aggregate
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- *************************************************** -->
<!-- *************************************************** -->
<!-- *************************************************** -->
<!-- Drag Preview Template -->
<!-- *************************************************** -->
<!-- *************************************************** -->
<ng-template #dragPreview let-col>
  <div class="p-2 border d-flex gap-2">
    <div><i class="bi bi-arrows-move"></i></div>
    <div>{{ col.header }}</div>
  </div>
</ng-template>

<!-- Drag Placeholder Template -->
<ng-template
  #dragPlaceholder
  let-col
  let-i="index"
  let-section="section"
  let-draggingInGroupArea="draggingInGroupArea"
>
  <div *ngIf="!draggingInGroupArea">
    <div
      *ngTemplateOutlet="
        headerCell;
        context: { $implicit: col, index: i, section: section }
      "
    ></div>
  </div>
  <div *ngIf="draggingInGroupArea">New Placeholder</div>
</ng-template>

<!-- Top Group Row Placeholder -->
<ng-template #topGroupingRowPlaceholder let-col let-showChevron="showChevron">
  <div class="d-flex gap-2">
    <div
      class="d-flex gap-2 top-row-grouping-placeholder"
      [style.backgroundColor]="topGroupedBadgesBackgroundColor"
    >
      <i class="bi bi-grid-3x2-gap-fill"></i>
      <span>{{ col.header }}</span>
      <i class="bi bi-x" (click)="ungroupColumn(col)"></i>
    </div>
  </div>
  <div *ngIf="showChevron" style="opacity: 0.6; font-size: 14px">
    <i class="bi bi-chevron-right"></i>
  </div>
</ng-template>

<ng-template
  #childHeaderPlaceholder
  let-col
  let-pinnedRight="pinnedRight"
  let-i="index"
  let-sections="sections"
>
  <div
    class="header-cell one-row-header-cells"
    [class.border-right]="showVerticalBorder"
    [style.width.px]="col.width"
    [style.min-width.px]="col.width"
    [style.min-height.px]="headerRowHeight"
    [style.max-height.px]="headerRowHeight"
    [class.border-right]="showVerticalBorder"
    [style.fontWeight]="headerFontWeight"
  >
    <div class="d-flex justify-content-between h-100 align-items-center w-100">
      <div
        class="d-flex justify-content-between w-100"
        [class.flex-row-reverse]="pinnedRight"
      >
        <div
          class="text-ellipsis h-100 d-flex align-items-center"
          [title]="col.header"
          [class.w-100]="pinnedRight"
        >
          {{ col.header }}
        </div>

        <div
          class="position-relative d-flex"
          [class.flex-row-reverse]="pinnedRight"
        >
          <div class="three-dots p-1" style="cursor: pointer">
            <i class="bi bi-three-dots-vertical"></i>
          </div>

          <div class="resize-handle">|</div>
        </div>
      </div>
    </div>
  </div>
  <div
    *ngIf="showFilterRow"
    [style.backgroundColor]="headerBackgroundColor"
    class="header-cell filter-cell"
    [class.border-right]="showVerticalBorder"
    [style.width.px]="col.width"
    [style.min-width.px]="col.width"
    [style.height.px]="headerRowHeight"
    [style.min-height.px]="headerRowHeight"
    [style.max-height.px]="headerRowHeight"
    [class.border-right]="showVerticalBorder"
    style="grid-row: 3"
  >
    <div
      class="header-cell filter-cell"
      [style.backgroundColor]="headerBackgroundColor"
      [style.width.px]="col.width"
      [style.min-width.px]="col.width"
      [style.height.px]="headerRowHeight"
      [style.min-height.px]="headerRowHeight"
      [style.max-height.px]="headerRowHeight"
    >
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Filter"
        [(ngModel)]="col.filterValue"
      />
      <span
        class="filter-icon-wrapper"
        (click)="activeFilterCell = col; activeCol = null"
        ><i class="bi bi-filter"></i
      ></span>

      <div
        class="position-absolute"
        *ngIf="activeFilterCell === col"
        style="top: 100%; right: 0; z-index: 10; left: 0"
      ></div>
    </div>
  </div>
</ng-template>

<ng-template #tableLayout>
  <div
    (click)="$event.stopPropagation()"
    class="p-3 shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 320px"
  >
    <div class="d-flex align-items-center mb-3">
      <button
        class="btn btn-link p-0"
        style="margin-left: -10px"
        (click)="toggleActions('setting')"
      >
        <span [inlineSVG]="'assets/icons/arrow-left.svg'" class="me-2"></span>
      </button>
      <h6 class="mb-0 fw-bold">Table Layout</h6>
    </div>
    <hr class="my-2" />
    <div class="w-100 mb-3 d-flex" role="group">
      <input
        type="radio"
        class="btn-check"
        name="layoutSize"
        id="small"
        autocomplete="off"
        (change)="changeTableLayout($event, 'small')"
        [checked]="selectedTableLayout == 'small'"
      />
      <label
        class="btn border d-flex flex-column align-items-center layout-button"
        for="small"
      >
        <div class="preview-box border mb-1"></div>
        Small
      </label>

      <input
        type="radio"
        class="btn-check"
        name="layoutSize"
        id="medium"
        autocomplete="off"
        [checked]="selectedTableLayout == 'medium'"
        (change)="changeTableLayout($event, 'medium')"
      />
      <label
        class="btn border mx-3 d-flex flex-column align-items-center layout-button"
        for="medium"
      >
        <div class="preview-box border mb-1"></div>
        Medium
      </label>

      <input
        type="radio"
        class="btn-check"
        name="layoutSize"
        id="large"
        autocomplete="off"
        (change)="changeTableLayout($event, 'large')"
        [checked]="selectedTableLayout == 'large'"
      />
      <label
        class="btn border d-flex flex-column align-items-center layout-button"
        for="large"
      >
        <div class="preview-box border mb-1"></div>
        Large
      </label>
    </div>

    <hr class="my-2" />
    <div class="d-flex justify-content-between align-items-center mb-2">
      <span>Show separators</span>
      <div class="form-check form-switch m-0">
        <input
          class="form-check-input"
          type="checkbox"
          id="separators"
          [(ngModel)]="showVerticalBorder"
        />
      </div>
    </div>
    <div class="d-flex justify-content-between align-items-center">
      <span>Row shading</span>
      <div class="form-check form-switch m-0">
        <input
          class="form-check-input"
          [(ngModel)]="rowShadingEnabled"
          (change)="toggleRowShading()"
          type="checkbox"
          id="rowShading"
        />
      </div>
    </div>
  </div>
</ng-template>

<ng-template #tablePreset>
  <div
    *ngIf="activeSubButton !== 'save-preset'"
    (click)="$event.stopPropagation()"
    class="p-3 shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 280px"
  >
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center">
        <button
          class="btn btn-link p-0"
          style="margin-left: -10px"
          (click)="toggleActions('setting')"
        >
          <span [inlineSVG]="'assets/icons/arrow-left.svg'"></span>
        </button>
        <h6 class="mb-0 fw-bold">Table Presets</h6>
      </div>
      <!-- Save Preset Button with Dropdown -->
      <div>
        <a
          class="text-decoration-none"
          type="button"
          id="savePresetDropdown"
          (click)="$event.stopPropagation(); toggleSubActions('save-preset')"
        >
          Save Preset
        </a>
      </div>
    </div>

    <!-- Search -->
    <div class="mb-3">
      <div class="col-12 global-search">
        <span
          [inlineSVG]="'assets/icons/search.svg'"
          class="mx-2 position-absolute"
        ></span>
        <input class="form-control form-control-sm" type="search" />
      </div>
    </div>

    <!-- Preset List -->
    <div class="list-group list-group-flush">
      <!-- Item -->
      <div
        class="list-group-item px-0 d-flex justify-content-between align-items-center"
      >
        <div>
          <div class="fw-semibold">
            CPR Stores
            <span class="badge bg-light text-primary ms-2">Default</span>
          </div>
          <small class="text-muted">Created Aug 14, 2025</small>
        </div>
        <div class="d-flex align-items-center">
          <span [inlineSVG]="'assets/icons/check-blue.svg'" class="me-2"></span>
          <div class="dropdown">
            <a
              href="javascript:void(0)"
              class="text-muted"
              data-bs-toggle="dropdown"
            >
              <span
                [inlineSVG]="'assets/icons/horizontal-dots.svg'"
                class="me-2"
              ></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <a class="dropdown-item d-flex align-items-center">
                <span [inlineSVG]="'assets/icons/star.svg'" class="me-2"></span>
                Set as default
              </a>

              <a class="dropdown-item d-flex align-items-center text-danger">
                <span
                  style="margin-top: -4px"
                  [inlineSVG]="'assets/icons/trash-red.svg'"
                  class="me-2"
                ></span>
                Delete
              </a>
            </ul>
          </div>
        </div>
      </div>

      <!-- Item End Here -->
    </div>
  </div>

  <div
    (click)="$event.stopPropagation()"
    *ngIf="activeSubButton == 'save-preset'"
    class="dropdown-menu p-3 badge mt-4 save-preset-dropdown mt-1"
    aria-labelledby="savePresetDropdown"
    style="min-width: 250px"
  >
    <div class="fw-bold fs-14px mb-2">Save preset</div>
    <div class="fs-14px mb-2" style="line-height: 20px">
      This will save the current table adjustments as a preset.
    </div>
    <!-- Input -->
    <div class="mb-2">
      <label for="presetName" class="form-label fs-12px fw-bold"
        >Preset Name</label
      >
      <div class="col-12 global-search">
        <input
          class="form-control form-control-sm ps-2"
          placeholder="Enter preset name"
          type="search"
        />
      </div>
    </div>

    <!-- Checkbox -->
    <div class="form-check mb-2">
      <input class="form-check-input" type="checkbox" id="saveFilters" />
      <label class="form-check-label mt-1" for="saveFilters">
        Save active filters
      </label>
    </div>

    <!-- Save Button -->
    <div class="d-flex justify-content-center gap-2" style="height: 32px">
      <button
        type="button"
        style="height: 32px"
        class="btn border w-100 d-flex align-items-center justify-content-center"
        (click)="$event.stopPropagation(); toggleActions('table-presets')"
        style="margin-top: -2px"
      >
        <span>Cancel</span>
      </button>
      <button
        type="button"
        style="height: 32px"
        class="btn btn-primary w-100 d-flex align-items-center justify-content-center"
      >
        <span style="margin-top: -2px">Save</span>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #showHideColumns>
  <div
    (click)="$event.stopPropagation()"
    class="p-3 shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 280px"
  >
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center">
        <button
          class="btn btn-link p-0"
          style="margin-left: -10px"
          (click)="toggleActions('setting')"
        >
          <span [inlineSVG]="'assets/icons/arrow-left.svg'"></span>
        </button>
        <h6 class="mb-0 fw-bold">Columns</h6>
      </div>
      <a
        (click)="resetColumns()"
        href="javascript:void(0)"
        class="text-primary text-decoration-none"
        >Reset</a
      >
    </div>

    <!-- Search -->
    <div class="mb-3">
      <div class="col-12 global-search">
        <span
          [inlineSVG]="'assets/icons/search.svg'"
          class="mx-2 position-absolute"
        ></span>
        <input
          class="form-control form-control-sm"
          placeholder="Serach column"
          type="search"
        />
      </div>
    </div>
    <!-- Preset List -->
    <div
      class="list-group list-group-flush"
      style="max-height: 500px; overflow: auto"
    >
      <div class="text-muted show-hide-table-label" *ngIf="hasAnyVisibleColumn">
        Show in table
      </div>
      <!-- Item -->
      <ng-container *ngFor="let col of columns">
        <div
          *ngIf="col.is_visible"
          class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center"
        >
          <div class="d-flex gap-1">
            <div style="margin-top: -3px">
              <span
                *ngIf="!col?.pinned"
                [inlineSVG]="'assets/icons/grip-vertical.svg'"
                class="cursor-grap"
                (mousedown)="$event.preventDefault()"
              ></span>
              <span
                *ngIf="col?.pinned"
                [inlineSVG]="'assets/icons/pin-blue.svg'"
                class="cursor-grap"
                (mousedown)="$event.preventDefault()"
              ></span>
            </div>
            <div class="fw-semibold">
              {{ col.header }}
            </div>
          </div>
          <div
            class="d-flex align-items-center"
            (click)="toggleColumnVisibility(col, false)"
          >
            <span [inlineSVG]="'assets/icons/eye.svg'" class="me-2"></span>
          </div>
        </div>
      </ng-container>

      <!-- Item End Here -->

      <div
        class="dropdown-divider"
        *ngIf="hasAnyVisibleColumn && hasAnyInVisibleColumn"
      ></div>

      <div
        class="text-muted show-hide-table-label"
        *ngIf="hasAnyInVisibleColumn"
      >
        Hide in table
      </div>
      <div class="list-group list-group-flush">
        <ng-container *ngFor="let col of columns">
          <div
            *ngIf="!col.is_visible"
            class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center"
          >
            <div class="d-flex gap-1">
              <div style="margin-top: -3px">
                <span
                  *ngIf="!col?.pinned"
                  [inlineSVG]="'assets/icons/grip-vertical.svg'"
                  class="cursor-grap"
                  (mousedown)="$event.preventDefault()"
                ></span>
                <span
                  *ngIf="col?.pinned"
                  [inlineSVG]="'assets/icons/pin-blue.svg'"
                  class="cursor-grap"
                  (mousedown)="$event.preventDefault()"
                ></span>
              </div>
              <div class="fw-semibold">
                {{ col.header }}
              </div>
            </div>
            <div
              class="d-flex align-items-center"
              (click)="toggleColumnVisibility(col, true)"
            >
              <span
                [inlineSVG]="'assets/icons/eye-cross.svg'"
                class="me-2"
              ></span>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Item End Here -->
    </div>
  </div>
</ng-template>

<ng-template #filterColumns let-col="column">
  <div
    @slideToggle
    *ngIf="!isFilterOpen && activeTopButton == 'filter-columns'"
    (click)="$event.stopPropagation()"
    class="shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 280px; right: unset; max-width: 230px"
  >
    <div class="mb-2 px-3">
      <div class="col-12 global-search">
        <span
          [inlineSVG]="'assets/icons/search.svg'"
          class="mx-2 position-absolute"
        ></span>
        <input
          class="form-control form-control-sm"
          placeholder="Filter by"
          type="search"
        />
      </div>
    </div>
    <div
      class="list-group list-group-flush"
      style="max-height: 500px; overflow: auto"
    >
      <ng-container *ngFor="let col of columns">
        <div
          (click)="openFilter(col)"
          *ngIf="
            col.is_visible &&
            !col?.query?.first_value &&
            !col?.query?._ids?.length
          "
          class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center dropdown-item cursor-pointer"
        >
          <div class="d-flex gap-1">
            <div style="margin-top: -3px"></div>
            <div class="fw-semibold">
              {{ col.header }}
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Dropdown -->
  <div
    @slideToggle
    *ngIf="isFilterOpen && selectedColumnForFilter.type == 'dropdown'"
    (click)="$event.stopPropagation()"
    class="shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 280px; right: unset; max-width: 230px"
  >
    <div class="mb-2 px-3">
      <div
        class="col-12 global-search position-relative border rounded d-flex align-items-center flex-wrap px-2 filter-serach-inpt"
      >
        <span
          *ngFor="let selected of selectedFilterOptions"
          class="badge d-flex align-items-center gap-1 me-1 mb-1"
        >
          {{ selected?.value ? selected.value : selected }}
          <span
            (click)="toggleSelectionInFilter(selected)"
            [inlineSVG]="'assets/icons/cross-primary.svg'"
            class="me-2"
          ></span>
        </span>
        <input
          class="form-control form-control-sm border-0 flex-grow-1"
          style="padding: 0"
          [placeholder]="selectedFilterOptions?.length ? '' : 'Filter by'"
          type="search"
          [(ngModel)]="searchTextForFilterDropDown"
          (keydown.backspace)="handleBackspace($event)"
        />
      </div>
    </div>
    <div
      class="list-group list-group-flush"
      style="max-height: 500px; overflow: auto"
    >
      <ng-container
        *ngFor="
          let col of selectedColumnForFilter.column_dropdown_value;
          let i = index
        "
      >
        <div
          class="list-group-item border-0 px-2 d-flex justify-content-between align-items-center dropdown-item cursor-pointer"
        >
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="i"
              [checked]="currentFilterSelectedIds.has(col.id || col._id || col)"
              (change)="toggleSelectionInFilter(col)"
            />
            <label class="form-check-label fw-semibold" [for]="i">
              {{ col?.value || col?.name || col }}
            </label>
          </div>
        </div>
      </ng-container>
    </div>
    <div
      class="d-flex justify-content-center gap-2 px-2 border-top"
      style="height: 38px"
    >
      <button
        type="button"
        style="height: 32px"
        class="btn btn-outline-secondary border w-100 d-flex align-items-center justify-content-center mt-1"
        (click)="$event.stopPropagation(); resetFilterChanges()"
      >
        <span>Cancel</span>
      </button>
      <button
        type="button"
        style="height: 32px"
        class="btn btn-primary w-100 d-flex align-items-center justify-content-center mt-1"
        (click)="applyDropdownFilter()"
      >
        <span style="margin-top: -2px">Save</span>
      </button>
    </div>
  </div>

  <!-- For Text fields and number fields-->

  <div
    @slideToggle
    *ngIf="
      isFilterOpen &&
      (selectedColumnForFilter.type == 'string' ||
        selectedColumnForFilter.type == 'number' ||
        selectedColumnForFilter.type == 'date')
    "
    (click)="$event.stopPropagation()"
    class="shadow rounded-3 bg-white actions-dropdown mt-1 dropdown-menu show shadow custom-menu table-layout"
    style="width: 280px; right: unset; max-width: 230px"
  >
    <div class="col-12 position-relative p-2 text-filter">
      <div class="mb-2">
        <select
          class="form-select form-select-sm custom-select"
          [(ngModel)]="firstCondition"
        >
          <option value="equal">Equals</option>
          <!-- <option value="not_equal">Not Equals</option> -->
          <option value="contain">Contains</option>
          <option value="before">Starts With</option>
          <option value="after">Ends With</option>
        </select>
      </div>
      <div class="mb-2">
        <input
          class="form-control form-control-sm"
          placeholder="Enter first value"
          type="search"
          [type]="
            selectedColumnForFilter.type == 'string'
              ? 'text'
              : selectedColumnForFilter.type
          "
          [(ngModel)]="firstValue"
        />
      </div>
      <div *ngIf="firstValue">
        <div class="d-flex my-3">
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              id="logicalAnd"
              name="logicalOperator"
              value="and"
              [(ngModel)]="condition"
            />
            <label class="form-check-label" for="logicalAnd">AND</label>
          </div>

          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              id="logicalOr"
              name="logicalOperator"
              value="or"
              [(ngModel)]="condition"
            />
            <label class="form-check-label" for="logicalOr">OR</label>
          </div>

          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              type="radio"
              id="logicalNone"
              name="logicalOperator"
              value="none"
              [(ngModel)]="condition"
            />
            <label class="form-check-label" for="logicalNone">None</label>
          </div>
        </div>

        <div class="my-3">
          <!-- Second condition select -->
          <select
            class="form-select form-select-sm"
            [(ngModel)]="secondCondition"
          >
            <option value="equal">Equals</option>
            <!-- <option value="not_equal">Not Equals</option> -->
            <option value="contain">Contains</option>
            <option value="before">Starts With</option>
            <option value="after">Ends With</option>
          </select>
        </div>

        <div class="mb-2">
          <!-- Second value input -->
          <input
            [type]="
              selectedColumnForFilter.type == 'string'
                ? 'text'
                : selectedColumnForFilter.type
            "
            class="form-control form-control-sm"
            placeholder="Enter second value"
            type="search"
            [(ngModel)]="secondValue"
          />
        </div>
      </div>
    </div>

    <div
      class="d-flex justify-content-center gap-2 px-2 border-top"
      style="height: 38px"
    >
      <button
        type="button"
        style="height: 32px"
        class="btn btn-outline-secondary border w-100 d-flex align-items-center justify-content-center mt-1"
        (click)="$event.stopPropagation(); resetTextFilterChanges()"
      >
        <span>Cancel</span>
      </button>
      <button
        type="button"
        style="height: 32px"
        class="btn btn-primary w-100 d-flex align-items-center justify-content-center mt-1"
        (click)="applyDropdownFilter()"
      >
        <span style="margin-top: -2px">Save</span>
      </button>
    </div>
  </div>
</ng-template>

<!-- Edit dropdown here -->
<ng-template let-col>
  <div class="drop-down-edit">
  </div>
</ng-template>
